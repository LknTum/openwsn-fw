<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<title>OpenWSN Smartgrid TSCH testbed: LKN contribution</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OpenWSN Smartgrid TSCH testbed
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">LKN contribution </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#TSCH_scheduling">TSCH scheduling</a></li>
<li class="level1"><a href="#IE_processing">IE processing</a></li>
<li class="level1"><a href="#MAC_behavior">MAC behavior</a></li>
<li class="level1"><a href="#Uinject_application">Uinject custom application</a></li>
<li class="level1"><a href="#Serial_compression">Serial compression</a></li>
<li class="level1"><a href="#Minor_changes">Minor changes</a><ul><li class="level2"><a href="#Addr_edits">Mote addressing</a></li>
<li class="level2"><a href="#Radio_edits">Changes in the Radio driver</a></li>
<li class="level2"><a href="#Neighbor_edits">Changes in the Neighbor table</a></li>
<li class="level2"><a href="#DAG_root">DAG root setup</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>We apported several modification to the firmware, in order to program the Zolertia Z1 motes for our TSCH Airplane testbed.</p>
<hr/>
 <h1><a class="anchor" id="TSCH_scheduling"></a>
TSCH scheduling</h1>
<p>We enabled a DAG root based scheduling by modifying the files <a class="el" href="schedule_8c.html">schedule.c</a> and <a class="el" href="schedule_8h.html">schedule.h</a> .</p>
<p>The setup applied in <a class="el" href="schedule_8h.html">schedule.h</a> by modifying the following frame parameters: </p><div class="fragment"><div class="line"><span class="preprocessor">#define SLOTFRAME_LENGTH    15</span></div><div class="line"><span class="preprocessor">#define NUMSERIALRX          1 </span></div><div class="line"><span class="preprocessor">#define NUMSLOTSOFF          1 </span></div><div class="line"><span class="preprocessor"></span></div><div class="line"><span class="preprocessor">#define SHARED FALSE</span></div><div class="line"></div><div class="line"><span class="comment">//draft-ietf-6tisch-minimal-06 </span></div><div class="line"><span class="comment"></span><span class="preprocessor">#define SCHEDULE_MINIMAL_6TISCH_ACTIVE_CELLS  SLOTFRAME_LENGTH-NUMSERIALRX-NUMSLOTSOFF//default 1</span></div><div class="line"><span class="preprocessor">#define SCHEDULE_MINIMAL_6TISCH_SLOTOFFSET                        1//deafult time slot 0</span></div><div class="line"><span class="preprocessor">#define SCHEDULE_MINIMAL_6TISCH_CHANNELOFFSET                     0//default freq channel 0</span></div><div class="line"><span class="preprocessor">#define SCHEDULE_MINIMAL_6TISCH_DEFAULT_SLOTFRAME_HANDLE          1 //id of slotframe</span></div><div class="line"><span class="preprocessor">#define SCHEDULE_MINIMAL_6TISCH_DEFAULT_SLOTFRAME_NUMBER          1 //1 slotframe by default.</span></div><div class="line"></div></div><!-- fragment --><p> The scheduling of the network is computed by the DAG root. In the function <a class="el" href="group___schedule.html#gade694f312044f8bff151d58c7976d067">schedule_startDAGroot</a> the scheduling is applied iteratively in this way:</p>
<div class="fragment"><div class="line">    addr_cnt=1;</div><div class="line">    <span class="keywordflow">for</span> (running_slotOffset=start_slotOffset;running_slotOffset&lt;start_slotOffset+<a class="code" href="group___schedule.html#ga299d7e29eb70888b68ace83fd3f1a8df">SCHEDULE_MINIMAL_6TISCH_ACTIVE_CELLS</a>;running_slotOffset++) {</div><div class="line">        temp_neighbor.addr_64b[7]   = addr_cnt;</div><div class="line">        addr_cnt++;</div><div class="line">      <a class="code" href="group___schedule.html#ga00825b0f7040c67065d65aadde478241">schedule_addActiveSlot</a>(</div><div class="line">         running_slotOffset,                 <span class="comment">// slot offset</span></div><div class="line">         <a class="code" href="group___schedule.html#ggad8490d4fdf8cef27f7e5fa6a37046a3da703f29e4d2b16980f09eceaeb7a35281">CELLTYPE_TXRX</a>,                      <span class="comment">// type of slot</span></div><div class="line">         <a class="code" href="group___schedule.html#ga884c794595c4aa480df9022648c29564">SHARED</a>,                               <span class="comment">// shared?</span></div><div class="line">         <a class="code" href="group___schedule.html#ga485a603a3e03059901c4fc5fc968a1e9">SCHEDULE_MINIMAL_6TISCH_CHANNELOFFSET</a>,    <span class="comment">// channel offset (default SCHEDULE_MINIMAL_6TISCH_CHANNELOFFSET) TODO try different offsets</span></div><div class="line">         &amp;temp_neighbor                      <span class="comment">// neighbor</span></div><div class="line">      );</div><div class="line">      <a class="code" href="group___schedule.html#gafbaaa0f57ce9c382c0fc00225a7b2078">debugPrint_schedule</a>();</div><div class="line">   }</div></div><!-- fragment --> <hr/>
 <h1><a class="anchor" id="IE_processing"></a>
IE processing</h1>
<p>In order to spread the DAG root scheduling over the whole network, we enabled the trasmission of link-specific address information and link settings.</p>
<p>In particular, we modified the functions <a class="el" href="process_i_e_8h.html#a222b2d57ad09b945b098f211cd159e53">processIE_prependSlotframeLinkIE</a>, <a class="el" href="process_i_e_8h.html#a41d90fd25e8ce294b9d7632d43089c80">processIE_retrieveSlotframeLinkIE</a> in <a class="el" href="process_i_e_8c.html">processIE.c</a> such that is possible to associate the address of a specific mote to the IE link scheduling parameter. Furthermore, the value of the SHARED flag is also transmitted and retrieved.</p>
<p>In <a class="el" href="process_i_e_8h.html#a222b2d57ad09b945b098f211cd159e53">processIE_prependSlotframeLinkIE</a>, we enabled the transmission of the address and the link option parameters in this way: </p><div class="fragment"><div class="line">   </div><div class="line">   <span class="comment">// For each link in the default schedule, add:</span></div><div class="line">   <span class="comment">// - [1B] linkOption bitmap</span></div><div class="line">   <span class="comment">// - [2B] channel offset</span></div><div class="line">   <span class="comment">// - [2B] timeslot</span></div><div class="line">   <span class="comment">// - [3B] Neighbour value -NEW</span></div><div class="line"> </div><div class="line">   <span class="comment">//===== shared cells</span></div><div class="line">   linkOption = (1&lt;&lt;<a class="code" href="group___i_e_e_e802154_e.html#ggaa8d5243a5473317d5e534e093d0842d2ad2ad324754167c22e203d395ab806743">FLAG_TX_S</a>)|(1&lt;&lt;<a class="code" href="group___i_e_e_e802154_e.html#ggaa8d5243a5473317d5e534e093d0842d2a5c0f22602ca83af1733a5e18a7e6f20f">FLAG_RX_S</a>)|(1&lt;&lt;<a class="code" href="group___i_e_e_e802154_e.html#ggaa8d5243a5473317d5e534e093d0842d2a60b8f45b435950f10cb9d755e09fa295">FLAG_SHARED_S</a>)|(1&lt;&lt;<a class="code" href="group___i_e_e_e802154_e.html#ggaa8d5243a5473317d5e534e093d0842d2aeea4c693b0c82c42470264523a1c2656">FLAG_TIMEKEEPING_S</a>);</div><div class="line">   <a class="code" href="pmc_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>=1;</div><div class="line">   <span class="keywordflow">for</span> (slotOffset=lastSlotOffset;slotOffset&gt;<a class="code" href="group___schedule.html#ga62c64cb1c9bbbb2927f358c14535fb7f">SCHEDULE_MINIMAL_6TISCH_SLOTOFFSET</a>;slotOffset--) {</div><div class="line">      <a class="code" href="group___packet_functions.html#ga690ad87588077409f382584732259925">packetfunctions_reserveHeaderSize</a>(pkt,6);</div><div class="line">      pkt-&gt;payload[0]   = (slotOffset-1)        &amp; 0xFF;             <span class="comment">// slotOffset</span></div><div class="line">      pkt-&gt;payload[1]   = ((slotOffset-1) &gt;&gt; 8) &amp; 0xFF;             <span class="comment">//</span></div><div class="line">      pkt-&gt;payload[2]   = <a class="code" href="group___schedule.html#ga485a603a3e03059901c4fc5fc968a1e9">SCHEDULE_MINIMAL_6TISCH_CHANNELOFFSET</a>;    <span class="comment">// channel offset</span></div><div class="line">      pkt-&gt;payload[3]   = 0x00;</div><div class="line">      pkt-&gt;payload[4]   = linkOption;                               <span class="comment">// linkOption bitmap</span></div><div class="line">      pkt-&gt;payload[5]   = slotOffset-1;                             <span class="comment">// Address value</span></div><div class="line">      <a class="code" href="pmc_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++;</div><div class="line">      len+=6;</div><div class="line">   }</div></div><!-- fragment --><p> In <a class="el" href="process_i_e_8h.html#a41d90fd25e8ce294b9d7632d43089c80">processIE_retrieveSlotframeLinkIE</a>, the opposite mechanism is implemented and properly enables the receiver to store the information into the next active slot: </p><div class="fragment"><div class="line">            <span class="comment">// [1B] LinkOption bitmap</span></div><div class="line">            linkInfo.linkoptions = *((<a class="code" href="_p_e___types_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>*)(pkt-&gt;payload)+localptr);</div><div class="line">            my_shared=(linkInfo.linkoptions &amp; ( 1 &lt;&lt; 6 )) &gt;&gt; 6; <span class="comment">//Retrieve the 6-th bit (SHARED)</span></div><div class="line">            localptr++;</div><div class="line">            </div><div class="line">            <span class="comment">// [3B] Neighbour value - LKN</span></div><div class="line">            neighAddr = *((<a class="code" href="_p_e___types_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>*)(pkt-&gt;payload)+localptr);</div><div class="line">            localptr++;</div><div class="line"></div><div class="line">            temp_neighbor.type         = <a class="code" href="opendefs_8h.html#a52864abcf6ebd8d120995b36fe6ce06eaaca0da977da87a831efebdda8b376fa1">ADDR_64B</a>;</div><div class="line">            temp_neighbor.addr_64b[0]   = 0x14;</div><div class="line">            temp_neighbor.addr_64b[1]   = 0x15;</div><div class="line">            temp_neighbor.addr_64b[2]   = 0x92;</div><div class="line">            temp_neighbor.addr_64b[3]   = 0xcc;</div><div class="line">            temp_neighbor.addr_64b[4]   = 0x00;</div><div class="line">            temp_neighbor.addr_64b[5]   = 0x00;</div><div class="line">            temp_neighbor.addr_64b[6]   = 0x00;</div><div class="line">            temp_neighbor.addr_64b[7]   = neighAddr;</div><div class="line">            </div><div class="line">            <span class="comment">// shared TXRX anycast slot(s)</span></div><div class="line">            <a class="code" href="group___schedule.html#ga00825b0f7040c67065d65aadde478241">schedule_addActiveSlot</a>(</div><div class="line">               linkInfo.tsNum,                     <span class="comment">// slot offset</span></div><div class="line">               <a class="code" href="group___schedule.html#ggad8490d4fdf8cef27f7e5fa6a37046a3da703f29e4d2b16980f09eceaeb7a35281">CELLTYPE_TXRX</a>,                      <span class="comment">// type of slot</span></div><div class="line">               my_shared,                          <span class="comment">// default false, not implemented</span></div><div class="line">               linkInfo.choffset,                  <span class="comment">// channel offset</span></div><div class="line">               &amp;temp_neighbor                      <span class="comment">// neighbor</span></div><div class="line">            );</div></div><!-- fragment --> <hr/>
 <h1><a class="anchor" id="MAC_behavior"></a>
MAC behavior</h1>
<p>The scope of our project is to enable proper link scheduling in TSCH. To this end, we modified the minimal version of the 802.15.4e MAC layer in order to support our scheduling mechanism.</p>
<p>All the parameters concerning the MAC layer can be set in <a class="el" href="_i_e_e_e802154_e_8h.html">IEEE802154E.h</a>. The channel hopping temnplate that we used is the following:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="_p_e___types_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> chTemplate_default[] = {</div><div class="line">   5,9,12,7,15,4,14,11,8,0,1,2,13,3,6,10</div><div class="line">};</div></div><!-- fragment --><p> Additionally, these are the MAC layer parameters that we used in our project:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define LKN_RECORD_RSSI               1 //enable recording rssi into the packet payload</span></div><div class="line"><span class="preprocessor">#define HOPPING                      1 // Boolean value for enabling freq. hopping</span></div><div class="line"><span class="preprocessor">#define SYNCHRONIZING_CHANNEL       20 // channel the mote listens on to synchronize</span></div><div class="line"><span class="preprocessor">#define TXRETRIES                    2 // number of MAC retries before declaring failed</span></div><div class="line"><span class="preprocessor">#define TX_POWER                     19 // 1=-25dBm, 31=0dBm (max value)</span></div><div class="line"><span class="preprocessor">#define RESYNCHRONIZATIONGUARD       5 // in 32kHz ticks. min distance to the end of the slot to successfully synchronize</span></div><div class="line"><span class="preprocessor">#define US_PER_TICK                 30 // number of us per 32kHz clock tick</span></div><div class="line"><span class="preprocessor">#define EBPERIOD                    10 // in seconds: sending EB every 30 seconds</span></div><div class="line"><span class="preprocessor">#define MAXKAPERIOD               2000 // in slots: @15ms per slot -&gt; ~30 seconds. Max value used by adaptive synchronization.</span></div><div class="line"><span class="preprocessor">#define DESYNCTIMEOUT             2333 // in slots: @15ms per slot -&gt; ~35 seconds. A larger DESYNCTIMEOUT is needed if using a larger KATIMEOUT.</span></div><div class="line"><span class="preprocessor">#define LIMITLARGETIMECORRECTION     5 // threshold number of ticks to declare a timeCorrection &quot;large&quot;</span></div><div class="line"><span class="preprocessor">#define LENGTH_IEEE154_MAX         128 // max length of a valid radio packet</span></div><div class="line"><span class="preprocessor">#define DUTY_CYCLE_WINDOW_LIMIT    (0xFFFFFFFF&gt;&gt;1) // limit of the dutycycle window</span></div></div><!-- fragment --><p>In order to enable address-specific scheduling parameters, we need to apport several major modifications in the file <a class="el" href="_i_e_e_e802154_e_8c.html">IEEE802154E.c</a>. The 802.15.4E code structure is summerized here: <a href="https://www.mindmeister.com/656557809/ieee802154e-code-structure" target="_blank">IEEE802154E code structure</a> by <a href="https://www.mindmeister.com/users/channel/12733408" target="_blank">Samuele Zoppi</a></p>
<p>First, we modified the main function of the MAC scheme, it determines the behavior during the current Time Slot, i.e., it enables the reception and/or transmission of packets.</p>
<p>We modified the function such that the mote can transmit or receive only if it is its own Time Slot. At the beginning, we set the value canTX to FALSE, then we turn it to TRUE by testing its address with respect of the current time slot.</p><ul>
<li>DAG root is always allowed to receive and transmit.</li>
<li>Motes are not allowed either to RX or TX in a Time Slot that doesn't match their address.</li>
</ul>
<div class="fragment"><div class="line">          <span class="comment">//Here checks the address</span></div><div class="line">          <a class="code" href="group___schedule.html#ga6a1d0334cd9da212a38a1db05e291d3a">schedule_getNeighbor</a>(&amp;cell_neighbor);</div><div class="line">          <span class="keywordflow">if</span>(!<a class="code" href="group___i_d_manager.html#ga4cff67772250923086a3d6476eb673c8">idmanager_isMyAddress</a>(&amp;cell_neighbor)){</div><div class="line">                <span class="keywordflow">if</span>(<a class="code" href="group___i_d_manager.html#gaa792e6561333f1615bbc61392e826d39">idmanager_getIsDAGroot</a>()==<a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>){</div><div class="line">                    <span class="comment">// this is NOT MY active slot, end the slot</span></div><div class="line">                    <a class="code" href="group___open_serial.html#ga3459b731e462b664947a4e3260c51512">openserial_stop</a>();</div><div class="line">                    <a class="code" href="_i_e_e_e802154_e_8c.html#a4d32f5f6b6be4f7b407550ae26a898df">endSlot</a>();</div><div class="line">                    <span class="comment">//start outputing serial</span></div><div class="line">                    <a class="code" href="group___open_serial.html#gaf25875805325e15644a0cc1ddf2d1ad7">openserial_startOutput</a>();</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }<span class="keywordflow">else</span>{</div><div class="line">                    <span class="comment">//I am DAG root but I don&#39;t need to TX</span></div><div class="line">                }</div><div class="line">          }<span class="keywordflow">else</span>{</div><div class="line">                <span class="comment">//It is my address</span></div><div class="line">                canTX=<a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line">          }</div><div class="line"></div><div class="line">         <span class="keywordflow">if</span>(canTX){</div><div class="line">             <span class="comment">// stop using serial</span></div><div class="line">             <a class="code" href="group___open_serial.html#ga3459b731e462b664947a4e3260c51512">openserial_stop</a>();</div><div class="line">             <span class="comment">// assuming that there is nothing to send</span></div><div class="line">             <a class="code" href="_i_e_e_e802154_e_8c.html#abbfc7f36c7b2d2635f4407908445a89b">ieee154e_vars</a>.<a class="code" href="structieee154e__vars__t.html#a88449ac7a09ec14e0053fdcf6a6ac790">dataToSend</a> = <a class="code" href="arm__cm4_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line">             <span class="comment">// check whether we can send</span></div><div class="line">             <span class="keywordflow">if</span> (<a class="code" href="group___schedule.html#gab5a0194710b51bf73b6aa363cb2fd8cb">schedule_getOkToSend</a>()) {</div><div class="line">                memset(&amp;neighbor,0,<span class="keyword">sizeof</span>(neighbor));</div><div class="line">                neighbor.type             = <a class="code" href="opendefs_8h.html#a52864abcf6ebd8d120995b36fe6ce06eac81661e9fd1e185f968667664896d0b9">ADDR_ANYCAST</a>;<span class="comment">//Allows to send a packet to ANYONE</span></div><div class="line">                <a class="code" href="_i_e_e_e802154_e_8c.html#abbfc7f36c7b2d2635f4407908445a89b">ieee154e_vars</a>.<a class="code" href="structieee154e__vars__t.html#a88449ac7a09ec14e0053fdcf6a6ac790">dataToSend</a> = <a class="code" href="group___open_queue.html#ga654ff57cc43c12704d87dc66fcfe7fa2">openqueue_macGetDataPacket</a>(&amp;neighbor);</div></div><!-- fragment --><p> Furthermore, we modified the behavior of the function <a class="el" href="_i_e_e_e802154_e_8c.html#a01c55569f4f1aadf1d4a156b08014e50">calculateFrequency</a> sucht that the calculation of the next frequency hop is enabled by the variable <a class="el" href="group___i_e_e_e802154_e.html#ga495914ac755e3089a99e6a6946c12971">HOPPING</a>. Otherwise, the next frequency is always set to the common <a class="el" href="group___i_e_e_e802154_e.html#gaf8be83417584fa06ecb6982f183bd222">SYNCHRONIZING_CHANNEL</a>.</p>
<div class="fragment"><div class="line">    <span class="keywordflow">if</span>(<a class="code" href="group___i_e_e_e802154_e.html#ga495914ac755e3089a99e6a6946c12971">HOPPING</a>){</div><div class="line">        <span class="keywordflow">return</span> 11 + <a class="code" href="_i_e_e_e802154_e_8c.html#abbfc7f36c7b2d2635f4407908445a89b">ieee154e_vars</a>.<a class="code" href="structieee154e__vars__t.html#a8ea426fa464ed96aeb12f16c2985171d">chTemplate</a>[(<a class="code" href="_i_e_e_e802154_e_8c.html#abbfc7f36c7b2d2635f4407908445a89b">ieee154e_vars</a>.<a class="code" href="structieee154e__vars__t.html#acd689febb1e54412f6faff6a6db0b5c9">asnOffset</a>+channelOffset)%16]; <span class="comment">//channel hopping</span></div><div class="line">    }<span class="keywordflow">else</span>{</div><div class="line">        <span class="keywordflow">return</span> <a class="code" href="group___i_e_e_e802154_e.html#gaf8be83417584fa06ecb6982f183bd222">SYNCHRONIZING_CHANNEL</a>;</div><div class="line">    }</div></div><!-- fragment --><p>Another major modification involves the management of the current Slot Offset. Previously, its cycle was based on a predefined value of the Frame Length, our contribution enables Slot Offset incraments and synchronization over arbitrary Frame Length lengths.</p>
<p>Here, we modify the function <a class="el" href="_i_e_e_e802154_e_8c.html#af7ddc5c9b10da0b029a6cdf13d40455d">incrementAsnOffset</a> to allow arbitrary values of Frame Length. </p><div class="fragment"><div class="line">   <span class="comment">// increment the offsets</span></div><div class="line">   frameLength = <a class="code" href="group___schedule.html#gad9d1ef9965017c2923cb6905b7cc6b7f">schedule_getFrameLength</a>();</div><div class="line">   <span class="keywordflow">if</span> (frameLength == 0) {</div><div class="line">      <a class="code" href="_i_e_e_e802154_e_8c.html#abbfc7f36c7b2d2635f4407908445a89b">ieee154e_vars</a>.<a class="code" href="structieee154e__vars__t.html#afaebb453ec589e83866278ddf8d1cb9d">slotOffset</a>++;</div><div class="line">   } <span class="keywordflow">else</span> {</div><div class="line">      <a class="code" href="_i_e_e_e802154_e_8c.html#abbfc7f36c7b2d2635f4407908445a89b">ieee154e_vars</a>.<a class="code" href="structieee154e__vars__t.html#afaebb453ec589e83866278ddf8d1cb9d">slotOffset</a>  = (<a class="code" href="_i_e_e_e802154_e_8c.html#abbfc7f36c7b2d2635f4407908445a89b">ieee154e_vars</a>.<a class="code" href="structieee154e__vars__t.html#afaebb453ec589e83866278ddf8d1cb9d">slotOffset</a>+1)%frameLength;</div><div class="line">   }</div></div><!-- fragment --><p> Then, the function <a class="el" href="_i_e_e_e802154_e_8c.html#aee836d385fb2379dd04956ad7b3cfe37">ieee154e_syncSlotOffset</a> was implemented. It allows the synchronization of the Slot Offset based on the current value of ASN. </p><div class="fragment"><div class="line"><a class="code" href="samr21__xpro_2board__info_8h.html#ac176b886c94b2cf591ec32600fb61a07">port_INLINE</a> <span class="keywordtype">void</span> <a class="code" href="_i_e_e_e802154_e_8c.html#aee836d385fb2379dd04956ad7b3cfe37">ieee154e_syncSlotOffset</a>() {</div><div class="line">   <a class="code" href="group___schedule.html#gab960413860c0b01b38ece025b0ee534d">frameLength_t</a> frameLength;</div><div class="line">   <a class="code" href="_p_e___types_8h.html#a33594304e786b158f3fb30289278f5af">uint32_t</a> slotOffset;</div><div class="line"></div><div class="line">   frameLength = <a class="code" href="group___schedule.html#gad9d1ef9965017c2923cb6905b7cc6b7f">schedule_getFrameLength</a>();</div><div class="line"></div><div class="line">   <span class="comment">// determine the current slotOffset</span></div><div class="line">   slotOffset = <a class="code" href="_i_e_e_e802154_e_8c.html#abbfc7f36c7b2d2635f4407908445a89b">ieee154e_vars</a>.<a class="code" href="structieee154e__vars__t.html#ad43118eadedc6a7dabf63f316bdda819">asn</a>.<a class="code" href="structasn__t.html#af158e9c9bc092ed0347896a9c024c258">byte4</a>;</div><div class="line">   slotOffset = slotOffset % frameLength;</div><div class="line">   slotOffset = slotOffset &lt;&lt; 16;</div><div class="line">   slotOffset = slotOffset + <a class="code" href="_i_e_e_e802154_e_8c.html#abbfc7f36c7b2d2635f4407908445a89b">ieee154e_vars</a>.<a class="code" href="structieee154e__vars__t.html#ad43118eadedc6a7dabf63f316bdda819">asn</a>.<a class="code" href="structasn__t.html#ae7a99f086ee6e28c6c72e248b6041b95">bytes2and3</a>;</div><div class="line">   slotOffset = slotOffset % frameLength;</div><div class="line">   slotOffset = slotOffset &lt;&lt; 16;</div><div class="line">   slotOffset = slotOffset + <a class="code" href="_i_e_e_e802154_e_8c.html#abbfc7f36c7b2d2635f4407908445a89b">ieee154e_vars</a>.<a class="code" href="structieee154e__vars__t.html#ad43118eadedc6a7dabf63f316bdda819">asn</a>.<a class="code" href="structasn__t.html#a9d2a032fe9b1adf08fc25d1cc73e8745">bytes0and1</a>;</div><div class="line">   slotOffset = slotOffset % frameLength;</div><div class="line"></div><div class="line">   <a class="code" href="_i_e_e_e802154_e_8c.html#abbfc7f36c7b2d2635f4407908445a89b">ieee154e_vars</a>.<a class="code" href="structieee154e__vars__t.html#afaebb453ec589e83866278ddf8d1cb9d">slotOffset</a>       = (<a class="code" href="group___schedule.html#ga30a663860a70d8c9db2c3a8e66f544fc">slotOffset_t</a>) slotOffset;</div><div class="line">}</div></div><!-- fragment --><p> The methods are then used in <a class="el" href="_i_e_e_e802154_e_8c.html#aa42be4c16fe53e0460a63ae76438d668">ieee154e_processIEs</a> to properly adapt the Slot Offset upon arrival of a new ASN value. </p><div class="fragment"><div class="line">         <span class="keywordflow">if</span> (f_asn2slotoffset == <a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>) {</div><div class="line">            <span class="comment">// at this point, ASN and frame length are known</span></div><div class="line">            <span class="comment">// the current slotoffset can be inferred</span></div><div class="line">            <a class="code" href="_i_e_e_e802154_e_8c.html#aee836d385fb2379dd04956ad7b3cfe37">ieee154e_syncSlotOffset</a>();</div><div class="line">            <a class="code" href="group___schedule.html#gaf44e496db5d623ea8168d0eaeffc8b2d">schedule_syncSlotOffset</a>(<a class="code" href="_i_e_e_e802154_e_8c.html#abbfc7f36c7b2d2635f4407908445a89b">ieee154e_vars</a>.<a class="code" href="structieee154e__vars__t.html#afaebb453ec589e83866278ddf8d1cb9d">slotOffset</a>);</div><div class="line">            <a class="code" href="_i_e_e_e802154_e_8c.html#abbfc7f36c7b2d2635f4407908445a89b">ieee154e_vars</a>.<a class="code" href="structieee154e__vars__t.html#a4c8775df9573fdd1e6a4cfe501d95d60">nextActiveSlotOffset</a> = <a class="code" href="group___schedule.html#ga01252633416fb574b1277b1303030248">schedule_getNextActiveSlotOffset</a>();</div><div class="line"></div><div class="line">            <a class="code" href="_i_e_e_e802154_e_8c.html#a8decad47b1e2b92bfc8a910f19d30ab3">ieee154e_syncAsnOffset</a>();</div><div class="line">         }</div></div><!-- fragment --><p>Finally, we stored the contents of different parameters under interest in the payload of our application. This allows us to collect packet-related information and analyze them in a second place.</p>
<p>Here, we store the value of the frequency used for transmission: </p><div class="fragment"><div class="line">   <span class="comment">//Set the tx frequency in the packet</span></div><div class="line">   <a class="code" href="_i_e_e_e802154_e_8c.html#abbfc7f36c7b2d2635f4407908445a89b">ieee154e_vars</a>.<a class="code" href="structieee154e__vars__t.html#a88449ac7a09ec14e0053fdcf6a6ac790">dataToSend</a>-&gt;<a class="code" href="struct_open_queue_entry__t.html#a1c9c4a2da1e43eb8d9fd2b310f9f524e">l4_payload</a>[3] = <a class="code" href="_i_e_e_e802154_e_8c.html#abbfc7f36c7b2d2635f4407908445a89b">ieee154e_vars</a>.<a class="code" href="structieee154e__vars__t.html#a98c1bb462ffdc5720382fc437a7893a3">freq</a>;</div><div class="line">   </div><div class="line">   <span class="comment">// configure the radio for that frequency</span></div><div class="line">    <span class="keywordflow">if</span>(!<a class="code" href="_i_e_e_e802154_e_8c.html#abbfc7f36c7b2d2635f4407908445a89b">ieee154e_vars</a>.<a class="code" href="structieee154e__vars__t.html#ace57dfc664b0948d066507ff4f7a77ff">my_couldSendEB</a>){</div><div class="line">        <a class="code" href="group__radio.html#gaa062a57421da7b960a2613e4f65d3a11">radio_setFrequency</a>(<a class="code" href="_i_e_e_e802154_e_8c.html#abbfc7f36c7b2d2635f4407908445a89b">ieee154e_vars</a>.<a class="code" href="structieee154e__vars__t.html#a98c1bb462ffdc5720382fc437a7893a3">freq</a>);</div><div class="line">    }<span class="keywordflow">else</span>{</div><div class="line">        <a class="code" href="group__radio.html#gaa062a57421da7b960a2613e4f65d3a11">radio_setFrequency</a>(<a class="code" href="group___i_e_e_e802154_e.html#gaf8be83417584fa06ecb6982f183bd222">SYNCHRONIZING_CHANNEL</a>);</div><div class="line">    }</div></div><!-- fragment --><p> Here, we store the value of the retransmission counter, once it is updated: </p><div class="fragment"></div><!-- fragment --><p> Here, we store the value of the received packet's RSSI: </p><div class="fragment"><div class="line">      <a class="code" href="_i_e_e_e802154_e_8c.html#abbfc7f36c7b2d2635f4407908445a89b">ieee154e_vars</a>.<a class="code" href="structieee154e__vars__t.html#afeb8cae851f042cb066c4b482fe519b3">dataReceived</a>-&gt;<a class="code" href="struct_open_queue_entry__t.html#aeeaf66f25c665e41a219c4097e5085da">payload</a>[<a class="code" href="_i_e_e_e802154_e_8c.html#abbfc7f36c7b2d2635f4407908445a89b">ieee154e_vars</a>.<a class="code" href="structieee154e__vars__t.html#afeb8cae851f042cb066c4b482fe519b3">dataReceived</a>-&gt;<a class="code" href="struct_open_queue_entry__t.html#aa3cf5004f2ac9ef3a888f42e726a5cce">length</a>-3] = 0xff - <a class="code" href="_i_e_e_e802154_e_8c.html#abbfc7f36c7b2d2635f4407908445a89b">ieee154e_vars</a>.<a class="code" href="structieee154e__vars__t.html#afeb8cae851f042cb066c4b482fe519b3">dataReceived</a>-&gt;<a class="code" href="struct_open_queue_entry__t.html#ae28cb0e81313085c3227cebe8ccecf33">l1_rssi</a> + 1;</div></div><!-- fragment --> <hr/>
 <h1><a class="anchor" id="Uinject_application"></a>
Uinject custom application</h1>
<p>In order to properly test the behavior of the network, we developed a simple application that sends uplink traffic periodically. Additionally, we designed the application to allocate payload bytes in order to track additional information about the packets that are sent.</p>
<p>First, we modified the <a class="el" href="openapps_8c.html">openapps.c</a> and <a class="el" href="openstack_8c.html">openstack.c</a> in order to allow the initialization of the <a class="el" href="group__uinject.html#gac6dcaebf6fba84d30d183c304c65040e">uinject_init</a>.</p>
<p>Then, we defined in <a class="el" href="uinject_8h.html">uinject.h</a> the periodicity <a class="el" href="group__uinject.html#ga5b31a0d33a0be3a28d77fbdba9a3e2b7">UINJECT_PERIOD_MS</a>, a data structure that contains a timer variable and a counter used to add numeration to the packets that are generated.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define UINJECT_PERIOD_MS 700</span></div><div class="line"></div><div class="line"><span class="comment">//=========================== typedef =========================================</span></div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div><div class="line">   <a class="code" href="group___open_timers.html#gae5ca9e65d270cdfa4bc74008d96d69ab">opentimer_id_t</a>       timerId;  </div><div class="line">   <a class="code" href="_p_e___types_8h.html#a1f1825b69244eb3ad2c7165ddc99c956">uint16_t</a>             <a class="code" href="boards_2eldorado_2radio_8c.html#a0480b812cba9c1d9c71a5fb1071bd0fc">counter</a>;  </div><div class="line">} <a class="code" href="structuinject__vars__t.html">uinject_vars_t</a>;</div><div class="line"></div></div><!-- fragment --><p> Furthermore, we set the destination address of our application to the DAG root address.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="_p_e___types_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> uinject_dst_addr[]   = {</div><div class="line">   0xbb, 0xbb, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,</div><div class="line">   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01</div><div class="line">};</div></div><!-- fragment --><p> Finally, here we report the code containg the details of the application that is exevuted in <a class="el" href="uinject_8c.html#a59951fd503ef80b9526ba1eaaf952d9b">uinject_task_cb</a>. Once the header of the packet is set, we increment the packet counter, and we reserve space for 5 bytes of additional information that will be stored later during the MAC layer operations.</p>
<div class="fragment"><div class="line">   <a class="code" href="uinject_8c.html#a24b960a84347986d2bc83683d2793bf0">uinject_vars</a>.<a class="code" href="structuinject__vars__t.html#a97940d6759ea18706492ae05ad24730f">counter</a>++;</div><div class="line">   </div><div class="line">   <a class="code" href="group___packet_functions.html#ga690ad87588077409f382584732259925">packetfunctions_reserveHeaderSize</a>(pkt,5*<span class="keyword">sizeof</span>(<a class="code" href="_p_e___types_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>));</div><div class="line">   *((<a class="code" href="_p_e___types_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>*)&amp;pkt-&gt;payload[0]) = <a class="code" href="group___i_e_e_e802154_e.html#ga2ad5d0a4cdd37feb8c5e52db2978062f">TXRETRIES</a>+1;</div><div class="line">   *((<a class="code" href="_p_e___types_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>*)&amp;pkt-&gt;payload[1]) = <a class="code" href="uinject_8c.html#a24b960a84347986d2bc83683d2793bf0">uinject_vars</a>.<a class="code" href="structuinject__vars__t.html#a97940d6759ea18706492ae05ad24730f">counter</a>&gt;&gt;8;</div><div class="line">   *((<a class="code" href="_p_e___types_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>*)&amp;pkt-&gt;payload[2]) = <a class="code" href="uinject_8c.html#a24b960a84347986d2bc83683d2793bf0">uinject_vars</a>.<a class="code" href="structuinject__vars__t.html#a97940d6759ea18706492ae05ad24730f">counter</a>;</div><div class="line">   *((<a class="code" href="_p_e___types_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>*)&amp;pkt-&gt;payload[3]) = 0; <span class="comment">//reserverd for frequency</span></div><div class="line">   *((<a class="code" href="_p_e___types_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>*)&amp;pkt-&gt;payload[4]) = 0; <span class="comment">//reserved for RSSI</span></div><div class="line"></div><div class="line">   <span class="keywordflow">if</span> ((<a class="code" href="group___open_udp.html#ga9e3ddc36106b92231cf7cfb3b5cabbd4">openudp_send</a>(pkt))==<a class="code" href="opendefs_8h.html#a85c7862086c1f92e4fb4108e176d8140afd5484f4c22c4ddd79b539facd9ad7eb">E_FAIL</a>) {</div><div class="line">      <a class="code" href="group___open_queue.html#ga326f90b6a0c7a331257b524a5af236d4">openqueue_freePacketBuffer</a>(pkt);</div><div class="line">   }</div></div><!-- fragment --> <hr/>
 <h1><a class="anchor" id="Serial_compression"></a>
Serial compression</h1>
<p>"Compress" the packets on serial interface in order to enable forwarding the packets to the openvisualizer faster. The "compression" only forwards part of the pkt id and its payload to the openvisualizer. Serial drivers are modified: <a class="el" href="openserial_8c.html">openserial.c</a> and <a class="el" href="openserial_8h.html">openserial.h</a></p>
<div class="fragment"><div class="line"></div><div class="line">  <a class="code" href="_p_e___types_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> isCompressed = 0;</div><div class="line">   <span class="keywordflow">if</span> (<a class="code" href="group___open_serial.html#ga6499f570e793bb2111f482628e521a1b">ENABLE_PKT_COMPRESSION</a>){</div><div class="line">    <a class="code" href="_p_e___types_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> isCompressed = 1;</div><div class="line">    <a class="code" href="openserial_8c.html#ac2be7cae6115dbefd4e59aa401b52598">outputHdlcWrite</a>(isCompressed);</div><div class="line"></div><div class="line">    <span class="comment">//danger! durty solution! to be changed if the packet structure changes</span></div><div class="line"></div><div class="line">    <span class="comment">//extract necessary data from buffer</span></div><div class="line">    <a class="code" href="_p_e___types_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> srcId = buffer[15];</div><div class="line">    <a class="code" href="_p_e___types_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> retx = buffer[<a class="code" href="namespacecc2538-bsl.html#a805cc7085603640390bef3787085a8aa">length</a>-5];</div><div class="line">    <a class="code" href="_p_e___types_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> seqN1 = buffer[<a class="code" href="namespacecc2538-bsl.html#a805cc7085603640390bef3787085a8aa">length</a>-4];</div><div class="line">    <a class="code" href="_p_e___types_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> seqN2 = buffer[<a class="code" href="namespacecc2538-bsl.html#a805cc7085603640390bef3787085a8aa">length</a>-3];</div><div class="line">    <a class="code" href="_p_e___types_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> freq = buffer[<a class="code" href="namespacecc2538-bsl.html#a805cc7085603640390bef3787085a8aa">length</a>-2];</div><div class="line">    <a class="code" href="_p_e___types_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> rssi = buffer[<a class="code" href="namespacecc2538-bsl.html#a805cc7085603640390bef3787085a8aa">length</a>-1];</div><div class="line">    <a class="code" href="openserial_8c.html#ac2be7cae6115dbefd4e59aa401b52598">outputHdlcWrite</a>(srcId);</div><div class="line">    <a class="code" href="openserial_8c.html#ac2be7cae6115dbefd4e59aa401b52598">outputHdlcWrite</a>(retx);</div><div class="line">    <a class="code" href="openserial_8c.html#ac2be7cae6115dbefd4e59aa401b52598">outputHdlcWrite</a>(seqN1);</div><div class="line">    <a class="code" href="openserial_8c.html#ac2be7cae6115dbefd4e59aa401b52598">outputHdlcWrite</a>(seqN2);</div><div class="line">    <a class="code" href="openserial_8c.html#ac2be7cae6115dbefd4e59aa401b52598">outputHdlcWrite</a>(freq);</div><div class="line">    <a class="code" href="openserial_8c.html#ac2be7cae6115dbefd4e59aa401b52598">outputHdlcWrite</a>(rssi);</div><div class="line"></div><div class="line">   }</div><div class="line">   <span class="keywordflow">else</span> {</div><div class="line">      <a class="code" href="openserial_8c.html#ac2be7cae6115dbefd4e59aa401b52598">outputHdlcWrite</a>(isCompressed);</div><div class="line">     <a class="code" href="openserial_8c.html#ac2be7cae6115dbefd4e59aa401b52598">outputHdlcWrite</a>(asn[0]);</div><div class="line">     <a class="code" href="openserial_8c.html#ac2be7cae6115dbefd4e59aa401b52598">outputHdlcWrite</a>(asn[1]);</div><div class="line">     <a class="code" href="openserial_8c.html#ac2be7cae6115dbefd4e59aa401b52598">outputHdlcWrite</a>(asn[2]);</div><div class="line">     <a class="code" href="openserial_8c.html#ac2be7cae6115dbefd4e59aa401b52598">outputHdlcWrite</a>(asn[3]);</div><div class="line">     <a class="code" href="openserial_8c.html#ac2be7cae6115dbefd4e59aa401b52598">outputHdlcWrite</a>(asn[4]);</div><div class="line">     <span class="keywordflow">for</span> (<a class="code" href="pmc_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;<a class="code" href="pmc_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code" href="namespacecc2538-bsl.html#a805cc7085603640390bef3787085a8aa">length</a>;<a class="code" href="pmc_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++){</div><div class="line">        <a class="code" href="openserial_8c.html#ac2be7cae6115dbefd4e59aa401b52598">outputHdlcWrite</a>(buffer[<a class="code" href="pmc_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div><div class="line">     }</div><div class="line">   }</div><div class="line"></div></div><!-- fragment --> <div class="fragment"><div class="line"><span class="preprocessor">#define ENABLE_PKT_COMPRESSION 0</span></div></div><!-- fragment --> <hr/>
 <h1><a class="anchor" id="Minor_changes"></a>
Minor changes</h1>
<h2><a class="anchor" id="Addr_edits"></a>
Mote addressing</h2>
<p>In the function <a class="el" href="group___i_d_manager.html#ga3e974443ae75269d00c3de03992a1669">idmanager_init</a> we modify the address of the motes.</p>
<p>The address of the device is set in this way: </p><div class="fragment"><div class="line">   <a class="code" href="idmanager_8c.html#a3b050a996ba4875e4327fb81fbb18c5b">idmanager_vars</a>.<a class="code" href="structidmanager__vars__t.html#a41c964b52056d4022c136419ab5d0704">my64bID</a>.<a class="code" href="structopen__addr__t.html#a2abdbb15dedda5606521852a4b4fc0ba">type</a>         = <a class="code" href="opendefs_8h.html#a52864abcf6ebd8d120995b36fe6ce06eaaca0da977da87a831efebdda8b376fa1">ADDR_64B</a>;</div><div class="line">   <a class="code" href="idmanager_8c.html#a3b050a996ba4875e4327fb81fbb18c5b">idmanager_vars</a>.<a class="code" href="structidmanager__vars__t.html#a41c964b52056d4022c136419ab5d0704">my64bID</a>.<a class="code" href="structopen__addr__t.html#a7ca9b0c966447d191c6f05e375571231">addr_64b</a>[0]   = 0x14;</div><div class="line">   <a class="code" href="idmanager_8c.html#a3b050a996ba4875e4327fb81fbb18c5b">idmanager_vars</a>.<a class="code" href="structidmanager__vars__t.html#a41c964b52056d4022c136419ab5d0704">my64bID</a>.<a class="code" href="structopen__addr__t.html#a7ca9b0c966447d191c6f05e375571231">addr_64b</a>[1]   = 0x15;</div><div class="line">   <a class="code" href="idmanager_8c.html#a3b050a996ba4875e4327fb81fbb18c5b">idmanager_vars</a>.<a class="code" href="structidmanager__vars__t.html#a41c964b52056d4022c136419ab5d0704">my64bID</a>.<a class="code" href="structopen__addr__t.html#a7ca9b0c966447d191c6f05e375571231">addr_64b</a>[2]   = 0x92;</div><div class="line">   <a class="code" href="idmanager_8c.html#a3b050a996ba4875e4327fb81fbb18c5b">idmanager_vars</a>.<a class="code" href="structidmanager__vars__t.html#a41c964b52056d4022c136419ab5d0704">my64bID</a>.<a class="code" href="structopen__addr__t.html#a7ca9b0c966447d191c6f05e375571231">addr_64b</a>[3]   = 0xcc;</div><div class="line">   <a class="code" href="idmanager_8c.html#a3b050a996ba4875e4327fb81fbb18c5b">idmanager_vars</a>.<a class="code" href="structidmanager__vars__t.html#a41c964b52056d4022c136419ab5d0704">my64bID</a>.<a class="code" href="structopen__addr__t.html#a7ca9b0c966447d191c6f05e375571231">addr_64b</a>[4]   = 0x00;</div><div class="line">   <a class="code" href="idmanager_8c.html#a3b050a996ba4875e4327fb81fbb18c5b">idmanager_vars</a>.<a class="code" href="structidmanager__vars__t.html#a41c964b52056d4022c136419ab5d0704">my64bID</a>.<a class="code" href="structopen__addr__t.html#a7ca9b0c966447d191c6f05e375571231">addr_64b</a>[5]   = 0x00;</div><div class="line">   <a class="code" href="idmanager_8c.html#a3b050a996ba4875e4327fb81fbb18c5b">idmanager_vars</a>.<a class="code" href="structidmanager__vars__t.html#a41c964b52056d4022c136419ab5d0704">my64bID</a>.<a class="code" href="structopen__addr__t.html#a7ca9b0c966447d191c6f05e375571231">addr_64b</a>[6]   = 0x00;</div><div class="line">   <a class="code" href="idmanager_8c.html#a3b050a996ba4875e4327fb81fbb18c5b">idmanager_vars</a>.<a class="code" href="structidmanager__vars__t.html#a41c964b52056d4022c136419ab5d0704">my64bID</a>.<a class="code" href="structopen__addr__t.html#a7ca9b0c966447d191c6f05e375571231">addr_64b</a>[7]   = 1;</div></div><!-- fragment --><p> If the device is DAG-root, then the prefix of the device is set in the following way: </p><div class="fragment"><div class="line">   <a class="code" href="idmanager_8c.html#a3b050a996ba4875e4327fb81fbb18c5b">idmanager_vars</a>.<a class="code" href="structidmanager__vars__t.html#ad563fc083ecc8c561374241382e76c89">myPrefix</a>.<a class="code" href="structopen__addr__t.html#a026c06dfd492ddbde8e4d4254fd35ce3">prefix</a>[0]   = 0xbb;</div><div class="line">   <a class="code" href="idmanager_8c.html#a3b050a996ba4875e4327fb81fbb18c5b">idmanager_vars</a>.<a class="code" href="structidmanager__vars__t.html#ad563fc083ecc8c561374241382e76c89">myPrefix</a>.<a class="code" href="structopen__addr__t.html#a026c06dfd492ddbde8e4d4254fd35ce3">prefix</a>[1]   = 0xbb;</div><div class="line">   <a class="code" href="idmanager_8c.html#a3b050a996ba4875e4327fb81fbb18c5b">idmanager_vars</a>.<a class="code" href="structidmanager__vars__t.html#ad563fc083ecc8c561374241382e76c89">myPrefix</a>.<a class="code" href="structopen__addr__t.html#a026c06dfd492ddbde8e4d4254fd35ce3">prefix</a>[2]   = 0x00;</div><div class="line">   <a class="code" href="idmanager_8c.html#a3b050a996ba4875e4327fb81fbb18c5b">idmanager_vars</a>.<a class="code" href="structidmanager__vars__t.html#ad563fc083ecc8c561374241382e76c89">myPrefix</a>.<a class="code" href="structopen__addr__t.html#a026c06dfd492ddbde8e4d4254fd35ce3">prefix</a>[3]   = 0x00;</div><div class="line">   <a class="code" href="idmanager_8c.html#a3b050a996ba4875e4327fb81fbb18c5b">idmanager_vars</a>.<a class="code" href="structidmanager__vars__t.html#ad563fc083ecc8c561374241382e76c89">myPrefix</a>.<a class="code" href="structopen__addr__t.html#a026c06dfd492ddbde8e4d4254fd35ce3">prefix</a>[4]   = 0x00;</div><div class="line">   <a class="code" href="idmanager_8c.html#a3b050a996ba4875e4327fb81fbb18c5b">idmanager_vars</a>.<a class="code" href="structidmanager__vars__t.html#ad563fc083ecc8c561374241382e76c89">myPrefix</a>.<a class="code" href="structopen__addr__t.html#a026c06dfd492ddbde8e4d4254fd35ce3">prefix</a>[5]   = 0x00;</div><div class="line">   <a class="code" href="idmanager_8c.html#a3b050a996ba4875e4327fb81fbb18c5b">idmanager_vars</a>.<a class="code" href="structidmanager__vars__t.html#ad563fc083ecc8c561374241382e76c89">myPrefix</a>.<a class="code" href="structopen__addr__t.html#a026c06dfd492ddbde8e4d4254fd35ce3">prefix</a>[6]   = 0x00;</div><div class="line">   <a class="code" href="idmanager_8c.html#a3b050a996ba4875e4327fb81fbb18c5b">idmanager_vars</a>.<a class="code" href="structidmanager__vars__t.html#ad563fc083ecc8c561374241382e76c89">myPrefix</a>.<a class="code" href="structopen__addr__t.html#a026c06dfd492ddbde8e4d4254fd35ce3">prefix</a>[7]   = 0x00;</div></div><!-- fragment --> <h2><a class="anchor" id="Radio_edits"></a>
Changes in the Radio driver</h2>
<p>The radio was hardcoded set to 0. In our code we set the PA_LEVEL in <a class="el" href="group__radio.html#gaf181029cf06b94f0f4ceaafec1c3f209">radio_reset</a> to 31. </p><div class="fragment"><div class="line">   cc2420_TXCTRL_reg.PA_LEVEL               = 31; <span class="comment">//31 max. TX power (~0dBm)</span></div></div><!-- fragment --> <h2><a class="anchor" id="Neighbor_edits"></a>
Changes in the Neighbor table</h2>
<p>In our code we set the <a class="el" href="group___neighbors.html#gaf83606573bb704d34705b540c226a0d9">MAXNUMNEIGHBORS</a> to 12 to enable a larger network. </p><div class="fragment"><div class="line"><span class="preprocessor">#define MAXNUMNEIGHBORS           12</span></div></div><!-- fragment --> <h2><a class="anchor" id="DAG_root"></a>
DAG root setup</h2>
<p>We modified the define in <a class="el" href="opendefs_8h.html">opendefs.h</a> in order to enable the DAG root state from the firmware. </p><div class="fragment"><div class="line"><span class="preprocessor">#define DAGROOT 1</span></div></div><!-- fragment --></div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Feb 23 2016 12:19:02 for OpenWSN Smartgrid TSCH testbed by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.12
</small></address>
</body>
</html>
