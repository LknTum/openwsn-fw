\hypertarget{projects_2xpressohack_2_open_w_s_n___o_s_2src_2main_8c}{}\section{/home/lkn/off\+Cloud/\+Smartgrid-\/code/\+Git\+Hub/openwsn-\/fw/projects/xpressohack/\+Open\+W\+S\+N\+\_\+\+O\+S/src/main.c File Reference}
\label{projects_2xpressohack_2_open_w_s_n___o_s_2src_2main_8c}\index{/home/lkn/off\+Cloud/\+Smartgrid-\/code/\+Git\+Hub/openwsn-\/fw/projects/xpressohack/\+Open\+W\+S\+N\+\_\+\+O\+S/src/main.\+c@{/home/lkn/off\+Cloud/\+Smartgrid-\/code/\+Git\+Hub/openwsn-\/fw/projects/xpressohack/\+Open\+W\+S\+N\+\_\+\+O\+S/src/main.\+c}}
{\ttfamily \#include $<$cr\+\_\+section\+\_\+macros.\+h$>$}\\*
{\ttfamily \#include $<$N\+X\+P/crp.\+h$>$}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{projects_2xpressohack_2_open_w_s_n___o_s_2src_2main_8c_a840291bc02cba5474a4cb46a9b9566fe}{main} (\hyperlink{usb__devapi_8h_afabf60e7f57651d6d595a02c75f07cd0}{void})
\begin{DoxyCompactList}\small\item\em This is a standalone test program for the L\+E\+Ds and 32k\+Hz crystal of the G\+I\+NA board. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\+\_\+\+\_\+\+C\+RP const unsigned int \hyperlink{projects_2xpressohack_2_open_w_s_n___o_s_2src_2main_8c_a2cf89d37cd40fb4274f5d428632e9ac5}{C\+R\+P\+\_\+\+W\+O\+RD} = C\+R\+P\+\_\+\+N\+O\+\_\+\+C\+RP
\item 
unsigned long \hyperlink{projects_2xpressohack_2_open_w_s_n___o_s_2src_2main_8c_ae25b56d219db42d80cb1b247d78bf277}{f\+\_\+cpu\+\_\+awake} = 100000000L
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\index{projects/xpressohack/\+Open\+W\+S\+N\+\_\+\+O\+S/src/main.\+c@{projects/xpressohack/\+Open\+W\+S\+N\+\_\+\+O\+S/src/main.\+c}!main@{main}}
\index{main@{main}!projects/xpressohack/\+Open\+W\+S\+N\+\_\+\+O\+S/src/main.\+c@{projects/xpressohack/\+Open\+W\+S\+N\+\_\+\+O\+S/src/main.\+c}}
\subsubsection[{\texorpdfstring{main(void)}{main(void)}}]{\setlength{\rightskip}{0pt plus 5cm}int main (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}\hypertarget{projects_2xpressohack_2_open_w_s_n___o_s_2src_2main_8c_a840291bc02cba5474a4cb46a9b9566fe}{}\label{projects_2xpressohack_2_open_w_s_n___o_s_2src_2main_8c_a840291bc02cba5474a4cb46a9b9566fe}


This is a standalone test program for the L\+E\+Ds and 32k\+Hz crystal of the G\+I\+NA board. 

\begin{DoxyNote}{Note}
The term \char`\"{}crystal\char`\"{} is usually written \char`\"{}\+X\+T\+A\+L\char`\"{} by embedded geeks.
\end{DoxyNote}
Download the program to a G\+I\+NA board, run it, you should see the 4 L\+E\+Ds blinking in sequence with a 500ms period.

The digital outputs are\+:
\begin{DoxyItemize}
\item P2.\+0\+: red L\+ED
\item P2.\+1\+: green L\+ED
\item P2.\+2\+: blue L\+ED
\item P2.\+3\+: red L\+ED
\end{DoxyItemize}

The \char`\"{}inputs\char`\"{} are\+:
\begin{DoxyItemize}
\item X\+IN, X\+O\+UT\+: 32768\+Hz crystal oscillator
\end{DoxyItemize}

The debug pins are\+:
\begin{DoxyItemize}
\item P5.\+6 output the A\+C\+LK (should be 32768\+Hz)
\item P1.\+1 toggles when interrupt T\+I\+M\+E\+R\+A0\+\_\+\+V\+E\+C\+T\+OR fires
\end{DoxyItemize}

\begin{DoxyAuthor}{Author}
Thomas Watteyne \href{mailto:watteyne@eecs.berkeley.edu}{\tt watteyne@eecs.\+berkeley.\+edu}, February 2012 The program starts executing here.
\end{DoxyAuthor}
This is a standalone test program for the L\+E\+Ds and 32k\+Hz crystal of the G\+I\+NA board.

The digital U\+A\+RT interface is\+:
\begin{DoxyItemize}
\item P3.\+7\+: A1\+\_\+\+S\+O\+M\+I\+\_\+\+RX
\item P3.\+8\+: A1\+\_\+\+S\+O\+M\+I\+\_\+\+TX
\end{DoxyItemize}

\begin{DoxyAuthor}{Author}
Thomas Watteyne \href{mailto:watteyne@eecs.berkeley.edu}{\tt watteyne@eecs.\+berkeley.\+edu}, February 2012 The program starts executing here.
\end{DoxyAuthor}
This is a standalone test program for the L\+E\+Ds and 32k\+Hz crystal of the G\+I\+NA board.

Download the program to a TelosB board, run it, and when you press the U\+S\+ER button, the red L\+ED with toggle. Note that the R\+E\+S\+ET button is non programmable, and always resets the M\+S\+P430.

\begin{DoxyNote}{Note}
To \char`\"{}toggle\char`\"{} a pin means that, when it\textquotesingle{}s off, it turns on, and when it\textquotesingle{}s on, it turns off.
\end{DoxyNote}
The digital outputs are\+:
\begin{DoxyItemize}
\item P5.\+4\+: red L\+ED
\end{DoxyItemize}

The digital inputs are\+:
\begin{DoxyItemize}
\item P2.\+7\+: button
\end{DoxyItemize}

\begin{DoxyAuthor}{Author}
Thomas Watteyne \href{mailto:watteyne@eecs.berkeley.edu}{\tt watteyne@eecs.\+berkeley.\+edu}, February 2012 The program starts executing here.
\end{DoxyAuthor}
This is a standalone test program for the L\+E\+Ds and 32k\+Hz crystal of the G\+I\+NA board.

$<$T\+O\+DO, what to buy$>$

$<$T\+O\+DO, how to connect the TelosB to the buzzer$>$

$<$T\+O\+DO, how to build the binary$>$

$<$T\+O\+DO, what to expect when it runs$>$

\begin{DoxyAuthor}{Author}
$<$T\+O\+DO, name$>$ $<$T\+O\+DO, e-\/mail$>$, $<$\+T\+O\+D\+O date$>$=\char`\"{}\char`\"{}$>$
\end{DoxyAuthor}
This is a standalone test program for the L\+E\+Ds and 32k\+Hz crystal of the G\+I\+NA board.

Download the program to a TelosB board, run it. It will output its clocks on the pins below. Note that these pins are connected to the L\+E\+Ds, so they will blink (so fast they will appear simply on to your slow eyes). Use a scope probe to see the clock signals and measure their frequency.

The digital outputs are\+:
\begin{DoxyItemize}
\item P5.\+4\+: M\+C\+LK (red L\+ED or pad 48 on the back)
\item P5.\+5\+: S\+M\+C\+LK (green L\+ED or pad 49 on the back)
\item P5.\+6\+: A\+C\+LK (blue L\+ED)
\end{DoxyItemize}

We measure an D\+CO frequency of 4.\+8\+M\+Hz. Very low, indeed.

\begin{DoxyAuthor}{Author}
Thomas Watteyne \href{mailto:watteyne@eecs.berkeley.edu}{\tt watteyne@eecs.\+berkeley.\+edu}, February 2012 The program starts executing here.
\end{DoxyAuthor}
This is a standalone test program for the L\+E\+Ds and 32k\+Hz crystal of the G\+I\+NA board.

This is a standalone test program for the L\+E\+Ds and 32k\+Hz crystal of the G\+I\+NA board.

The digital S\+PI interface consists of\+:


\begin{DoxyItemize}
\item P3.\+2/\+S\+O\+M\+I0\+: \char`\"{}slave-\/out-\/master-\/in\char`\"{}, i.\+e. C\+C2420-\/$>$M\+S\+P430
\item P3.\+3/\+S\+CL\+: clock line
\item P4.\+2\+: chip-\/select (active-\/low) Extra lines\+:
\item P1.\+7\+: \char`\"{}slave-\/it-\/master-\/out\char`\"{}, i.\+e. M\+S\+P430-\/$>$C\+C2420
\end{DoxyItemize}

\begin{DoxyAuthor}{Author}
Thomas Watteyne \href{mailto:watteyne@eecs.berkeley.edu}{\tt watteyne@eecs.\+berkeley.\+edu}, February 2012
\end{DoxyAuthor}
This is a standalone test program for the L\+E\+Ds and 32k\+Hz crystal of the G\+I\+NA board.

\begin{DoxyNote}{Note}
The term \char`\"{}crystal\char`\"{} is usually written \char`\"{}\+X\+T\+A\+L\char`\"{} by embedded geeks.
\end{DoxyNote}
Download the program to a TelosB board, run it, you should see the 3 L\+E\+Ds blinking in sequence with a 500ms period.

The digital outputs are\+:
\begin{DoxyItemize}
\item P5.\+4\+: red L\+ED
\item P5.\+5\+: green L\+ED
\item P5.\+6\+: blue L\+ED
\end{DoxyItemize}

The \char`\"{}inputs\char`\"{} are\+:
\begin{DoxyItemize}
\item X\+IN, X\+O\+UT\+: 32768\+Hz crystal oscillator
\end{DoxyItemize}

The debug pins are\+:
\begin{DoxyItemize}
\item P6.\+6 toggles when interrupt T\+I\+M\+E\+R\+A0\+\_\+\+V\+E\+C\+T\+OR fires
\end{DoxyItemize}

\begin{DoxyAuthor}{Author}
Thomas Watteyne \href{mailto:watteyne@eecs.berkeley.edu}{\tt watteyne@eecs.\+berkeley.\+edu}, February 2012 The program starts executing here.
\end{DoxyAuthor}
This is a standalone test program for the L\+E\+Ds and 32k\+Hz crystal of the G\+I\+NA board.

\begin{DoxyNote}{Note}
The term \char`\"{}micro-\/controller\char`\"{} is usually written \char`\"{}u\+C\char`\"{} by embedded geeks.
\end{DoxyNote}
Download the program to a TelosB board, run it, you should see the red, then the green, then the blue L\+E\+Ds go on (all within less than a second). This is the sequence of events\+:
\begin{DoxyItemize}
\item enable and reset the radio ==$>$ red L\+ED on
\item configure S\+PI registers on M\+S\+P430
\item send a S\+N\+OP strobe to radio ==$>$ green L\+ED on
\item receive status byte from radio ==$>$ blue L\+ED on
\item go to sleep
\end{DoxyItemize}

The digital S\+PI interface consists of\+:
\begin{DoxyItemize}
\item P3.\+1/\+S\+I\+M\+O0\+: \char`\"{}slave-\/it-\/master-\/out\char`\"{}, i.\+e. M\+S\+P430-\/$>$C\+C2420
\item P3.\+2/\+S\+O\+M\+I0\+: \char`\"{}slave-\/out-\/master-\/in\char`\"{}, i.\+e. C\+C2420-\/$>$M\+S\+P430
\item P3.\+3/\+S\+CL\+: clock line
\item P4.\+2\+: chip-\/select (active-\/low) Extra lines\+:
\item P4.\+5\+: radio V\+R\+EG (active-\/high)
\item P4.\+6\+: radio reset line (active-\/low)
\end{DoxyItemize}

\begin{DoxyAuthor}{Author}
Thomas Watteyne \href{mailto:watteyne@eecs.berkeley.edu}{\tt watteyne@eecs.\+berkeley.\+edu}, February 2012
\end{DoxyAuthor}
This is a standalone test program for the L\+E\+Ds and 32k\+Hz crystal of the G\+I\+NA board.

The M\+S\+P430 chip speaks 2-\/wire U\+A\+RT, i.\+e. one two pins are used\+: one for sending bytes (U\+A\+R\+T1\+TX), one for receiving bytes (U\+A\+R\+T1\+RX). These pins are connected to an F\+T\+DI \char`\"{}\+U\+A\+R\+T-\/to-\/\+U\+S\+B\char`\"{} converted chip. When you plug the TelosB into your computer, the F\+T\+DI driver install a virtual C\+OM port. That is, when you read/write to that port, the bytes end up on the U\+A\+R\+T1\+R\+X/\+U\+A\+R\+T1\+TX pins.

Connect your TelosB board to your computer, download this application to your TelosB board and run it. On your computer, open a Pu\+T\+TY client on the virtual C\+OM port of your board, and type characters into it.

Each time you type a character, you should see\+:
\begin{DoxyItemize}
\item the small green L\+ED (RX) blinks. It\textquotesingle{}s mounted on the RX line, so \char`\"{}shows\char`\"{} you when a byte passes.
\item the character prints on your terminal, as it is sent back on the TX line.
\item the red L\+ED toggles
\item the smalll red L\+ED (TX) blinks. It\textquotesingle{}s mounted on the TX line, so \char`\"{}shows\char`\"{} you when a byte passes.
\end{DoxyItemize}

Uncomment the B\+A\+U\+D\+R\+A\+T\+E\+\_\+115200 line below to switch from 9600baud to 115200baud.

The digital U\+A\+RT interface is\+:
\begin{DoxyItemize}
\item P3.\+6\+: U\+A\+R\+T1\+TX
\item P3.\+7\+: U\+A\+R\+T1\+RX
\end{DoxyItemize}

\begin{DoxyAuthor}{Author}
Thomas Watteyne \href{mailto:watteyne@eecs.berkeley.edu}{\tt watteyne@eecs.\+berkeley.\+edu}, February 2012 The program starts executing here.
\end{DoxyAuthor}
This is a standalone test program for the L\+E\+Ds and 32k\+Hz crystal of the G\+I\+NA board.

\begin{DoxyAuthor}{Author}
Thomas Watteyne \href{mailto:watteyne@eecs.berkeley.edu}{\tt watteyne@eecs.\+berkeley.\+edu}, February 2012 The program starts executing here.
\end{DoxyAuthor}
This is a standalone test program for the L\+E\+Ds and 32k\+Hz crystal of the G\+I\+NA board.

Download the program to a W\+S\+N430v14 board, run it. It will configure the clock sources of the W\+S\+N430v14, and output its clocks on pins.

The following clock sources are used\+:
\begin{DoxyItemize}
\item the 8\+M\+Hz crystal on the W\+S\+N40v14 is connected to the X\+T2 clock source
\item the 32k\+Hz crystal on the W\+S\+N40v14 is connected to the L\+F\+X\+T1
\end{DoxyItemize}

From those two, the following clock signals are created\+:
\begin{DoxyItemize}
\item M\+C\+LK is set to X\+T2, i.\+e. 8\+M\+Hz
\item S\+M\+C\+LK is set to X\+T2/8, i.\+e. 1\+M\+Hz
\item A\+C\+LK is set to L\+F\+X\+T1, i.\+e. 32k\+Hz
\end{DoxyItemize}

The digital outputs are\+:
\begin{DoxyItemize}
\item P5.\+4\+: M\+C\+LK (red L\+ED), expected period 125ns
\item P5.\+5\+: S\+M\+C\+LK (green L\+ED), expected period 1000ns
\item P5.\+6\+: A\+C\+LK (blue L\+ED), expected period 30517ns
\end{DoxyItemize}

Note that these pins are connected to the L\+E\+Ds, so they will blink (so fast they will appear simply on to your slow eyes). Use a scope os logic analyzer to see the clock signals and measure their frequency.

\begin{DoxyAuthor}{Author}
Thomas Watteyne \href{mailto:watteyne@eecs.berkeley.edu}{\tt watteyne@eecs.\+berkeley.\+edu}, August 2014. The program starts executing here.
\end{DoxyAuthor}
This is a standalone test program for the L\+E\+Ds and 32k\+Hz crystal of the G\+I\+NA board.

\begin{DoxyNote}{Note}
The term \char`\"{}crystal\char`\"{} is usually written \char`\"{}\+X\+T\+A\+L\char`\"{} by embedded geeks.
\end{DoxyNote}
Download the program to a W\+S\+N430v14 board, run it, you should see the 3 L\+E\+Ds blinking in sequence with a 500ms period.

The digital outputs are\+:
\begin{DoxyItemize}
\item P5.\+4\+: red L\+ED
\item P5.\+5\+: green L\+ED
\item P5.\+6\+: blue L\+ED
\end{DoxyItemize}

The \char`\"{}inputs\char`\"{} are\+:
\begin{DoxyItemize}
\item X\+IN, X\+O\+UT\+: 32768\+Hz crystal oscillator
\end{DoxyItemize}

The debug pins are\+:
\begin{DoxyItemize}
\item P2.\+1 toggles when interrupt T\+I\+M\+E\+R\+A0\+\_\+\+V\+E\+C\+T\+OR fires
\end{DoxyItemize}

\begin{DoxyAuthor}{Author}
Thomas Watteyne \href{mailto:watteyne@eecs.berkeley.edu}{\tt watteyne@eecs.\+berkeley.\+edu}, August 2014. The program starts executing here.
\end{DoxyAuthor}
This is a standalone test program for the L\+E\+Ds and 32k\+Hz crystal of the G\+I\+NA board.

\begin{DoxyNote}{Note}
The term \char`\"{}micro-\/controller\char`\"{} is usually written \char`\"{}u\+C\char`\"{} by embedded geeks.
\end{DoxyNote}
Download the program to a W\+S\+N430v14 board, run it, you should see the red, then the green, then the blue L\+E\+Ds go on (all within less than a second). This is the sequence of events\+:
\begin{DoxyItemize}
\item enable and reset the radio ==$>$ red L\+ED on
\item configure S\+PI registers on M\+S\+P430
\item send a S\+N\+OP strobe to radio ==$>$ green L\+ED on
\item receive status byte from radio ==$>$ blue L\+ED on
\item go to sleep
\end{DoxyItemize}

The digital S\+PI interface consists of\+:
\begin{DoxyItemize}
\item P5.\+1/\+S\+I\+M\+O1\+: \char`\"{}slave-\/it-\/master-\/out\char`\"{}, i.\+e. M\+S\+P430-\/$>$C\+C2420
\item P5.\+2/\+S\+O\+M\+I0\+: \char`\"{}slave-\/out-\/master-\/in\char`\"{}, i.\+e. C\+C2420-\/$>$M\+S\+P430
\item P5.\+3/\+U\+C\+L\+K1\+: clock line
\item P4.\+2\+: chip-\/select (active-\/low) Extra lines\+:
\item P3.\+0\+: radio V\+R\+EG (active-\/high)
\item P1.\+7\+: radio reset line (active-\/low)
\end{DoxyItemize}

\begin{DoxyAuthor}{Author}
Thomas Watteyne \href{mailto:watteyne@eecs.berkeley.edu}{\tt watteyne@eecs.\+berkeley.\+edu}, August 2014.
\end{DoxyAuthor}
This is a standalone test program for the L\+E\+Ds and 32k\+Hz crystal of the G\+I\+NA board.

The M\+S\+P430 chip speaks 2-\/wire U\+A\+RT, i.\+e. two pins are used\+: one for sending bytes (U\+T\+X\+D0), one for receiving bytes (U\+R\+X\+D0). When you plug the W\+S\+N430 into your computer, it appears as a serial C\+OM port. That is, when you read/write to that port, the bytes end up on the U\+T\+X\+D0/\+U\+R\+X\+D0 pins.

Connect your W\+S\+N430v14 board to your computer, download this application to your W\+S\+N430v14 board and run it. On your computer, open a Pu\+T\+TY client on the C\+OM port of your board, and type characters into it.

Each time you type a character, you should see\+:
\begin{DoxyItemize}
\item the character prints on your terminal, as it is sent back on the TX line.
\item the red L\+ED toggles.
\end{DoxyItemize}

The digital U\+A\+RT interface is\+:
\begin{DoxyItemize}
\item P3.\+4\+: U\+T\+X\+D0
\item P3.\+5\+: U\+R\+X\+D0
\end{DoxyItemize}

\begin{DoxyAuthor}{Author}
Thomas Watteyne \href{mailto:watteyne@eecs.berkeley.edu}{\tt watteyne@eecs.\+berkeley.\+edu}, August 2012. The program starts executing here.
\end{DoxyAuthor}
This is a standalone test program for the L\+E\+Ds and 32k\+Hz crystal of the G\+I\+NA board.

\begin{DoxyAuthor}{Author}
xavi vilajosana \href{mailto:xvilajosana@eecs.berkeley.edu}{\tt xvilajosana@eecs.\+berkeley.\+edu}, March 2012
\end{DoxyAuthor}
This is a standalone test program for the L\+E\+Ds and 32k\+Hz crystal of the G\+I\+NA board.

\begin{DoxyAuthor}{Author}
Thomas Watteyne \href{mailto:watteyne@eecs.berkeley.edu}{\tt watteyne@eecs.\+berkeley.\+edu}, February 2012 
\end{DoxyAuthor}


Definition at line 29 of file main.\+c.



\subsection{Variable Documentation}
\index{projects/xpressohack/\+Open\+W\+S\+N\+\_\+\+O\+S/src/main.\+c@{projects/xpressohack/\+Open\+W\+S\+N\+\_\+\+O\+S/src/main.\+c}!C\+R\+P\+\_\+\+W\+O\+RD@{C\+R\+P\+\_\+\+W\+O\+RD}}
\index{C\+R\+P\+\_\+\+W\+O\+RD@{C\+R\+P\+\_\+\+W\+O\+RD}!projects/xpressohack/\+Open\+W\+S\+N\+\_\+\+O\+S/src/main.\+c@{projects/xpressohack/\+Open\+W\+S\+N\+\_\+\+O\+S/src/main.\+c}}
\subsubsection[{\texorpdfstring{C\+R\+P\+\_\+\+W\+O\+RD}{CRP_WORD}}]{\setlength{\rightskip}{0pt plus 5cm}\+\_\+\+\_\+\+C\+RP const unsigned int C\+R\+P\+\_\+\+W\+O\+RD = C\+R\+P\+\_\+\+N\+O\+\_\+\+C\+RP}\hypertarget{projects_2xpressohack_2_open_w_s_n___o_s_2src_2main_8c_a2cf89d37cd40fb4274f5d428632e9ac5}{}\label{projects_2xpressohack_2_open_w_s_n___o_s_2src_2main_8c_a2cf89d37cd40fb4274f5d428632e9ac5}


Definition at line 21 of file main.\+c.

\index{projects/xpressohack/\+Open\+W\+S\+N\+\_\+\+O\+S/src/main.\+c@{projects/xpressohack/\+Open\+W\+S\+N\+\_\+\+O\+S/src/main.\+c}!f\+\_\+cpu\+\_\+awake@{f\+\_\+cpu\+\_\+awake}}
\index{f\+\_\+cpu\+\_\+awake@{f\+\_\+cpu\+\_\+awake}!projects/xpressohack/\+Open\+W\+S\+N\+\_\+\+O\+S/src/main.\+c@{projects/xpressohack/\+Open\+W\+S\+N\+\_\+\+O\+S/src/main.\+c}}
\subsubsection[{\texorpdfstring{f\+\_\+cpu\+\_\+awake}{f_cpu_awake}}]{\setlength{\rightskip}{0pt plus 5cm}unsigned long f\+\_\+cpu\+\_\+awake = 100000000L}\hypertarget{projects_2xpressohack_2_open_w_s_n___o_s_2src_2main_8c_ae25b56d219db42d80cb1b247d78bf277}{}\label{projects_2xpressohack_2_open_w_s_n___o_s_2src_2main_8c_ae25b56d219db42d80cb1b247d78bf277}


Definition at line 26 of file main.\+c.

