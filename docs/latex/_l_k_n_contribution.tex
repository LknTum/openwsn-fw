We apported several modification to the firmware, in order to program the Zolertia Z1 motes for our T\+S\+CH Airplane testbed.



 \hypertarget{_l_k_n_contribution_Addr_edits}{}\section{Mote addressing}\label{_l_k_n_contribution_Addr_edits}
In the function \hyperlink{group___i_d_manager_ga3e974443ae75269d00c3de03992a1669}{idmanager\+\_\+init} we modify the address of the motes.

The address of the device is set in this way\+: 
\begin{DoxyCodeInclude}
   \hyperlink{idmanager_8c_a3b050a996ba4875e4327fb81fbb18c5b}{idmanager\_vars}.\hyperlink{structidmanager__vars__t_a41c964b52056d4022c136419ab5d0704}{my64bID}.\hyperlink{structopen__addr__t_a2abdbb15dedda5606521852a4b4fc0ba}{type}         = \hyperlink{opendefs_8h_a52864abcf6ebd8d120995b36fe6ce06eaaca0da977da87a831efebdda8b376fa1}{ADDR\_64B};
   \hyperlink{idmanager_8c_a3b050a996ba4875e4327fb81fbb18c5b}{idmanager\_vars}.\hyperlink{structidmanager__vars__t_a41c964b52056d4022c136419ab5d0704}{my64bID}.\hyperlink{structopen__addr__t_a7ca9b0c966447d191c6f05e375571231}{addr\_64b}[0]   = 0x14;
   \hyperlink{idmanager_8c_a3b050a996ba4875e4327fb81fbb18c5b}{idmanager\_vars}.\hyperlink{structidmanager__vars__t_a41c964b52056d4022c136419ab5d0704}{my64bID}.\hyperlink{structopen__addr__t_a7ca9b0c966447d191c6f05e375571231}{addr\_64b}[1]   = 0x15;
   \hyperlink{idmanager_8c_a3b050a996ba4875e4327fb81fbb18c5b}{idmanager\_vars}.\hyperlink{structidmanager__vars__t_a41c964b52056d4022c136419ab5d0704}{my64bID}.\hyperlink{structopen__addr__t_a7ca9b0c966447d191c6f05e375571231}{addr\_64b}[2]   = 0x92;
   \hyperlink{idmanager_8c_a3b050a996ba4875e4327fb81fbb18c5b}{idmanager\_vars}.\hyperlink{structidmanager__vars__t_a41c964b52056d4022c136419ab5d0704}{my64bID}.\hyperlink{structopen__addr__t_a7ca9b0c966447d191c6f05e375571231}{addr\_64b}[3]   = 0xcc;
   \hyperlink{idmanager_8c_a3b050a996ba4875e4327fb81fbb18c5b}{idmanager\_vars}.\hyperlink{structidmanager__vars__t_a41c964b52056d4022c136419ab5d0704}{my64bID}.\hyperlink{structopen__addr__t_a7ca9b0c966447d191c6f05e375571231}{addr\_64b}[4]   = 0x00;
   \hyperlink{idmanager_8c_a3b050a996ba4875e4327fb81fbb18c5b}{idmanager\_vars}.\hyperlink{structidmanager__vars__t_a41c964b52056d4022c136419ab5d0704}{my64bID}.\hyperlink{structopen__addr__t_a7ca9b0c966447d191c6f05e375571231}{addr\_64b}[5]   = 0x00;
   \hyperlink{idmanager_8c_a3b050a996ba4875e4327fb81fbb18c5b}{idmanager\_vars}.\hyperlink{structidmanager__vars__t_a41c964b52056d4022c136419ab5d0704}{my64bID}.\hyperlink{structopen__addr__t_a7ca9b0c966447d191c6f05e375571231}{addr\_64b}[6]   = 0x00;
   \hyperlink{idmanager_8c_a3b050a996ba4875e4327fb81fbb18c5b}{idmanager\_vars}.\hyperlink{structidmanager__vars__t_a41c964b52056d4022c136419ab5d0704}{my64bID}.\hyperlink{structopen__addr__t_a7ca9b0c966447d191c6f05e375571231}{addr\_64b}[7]   = 1;
\end{DoxyCodeInclude}
 If the device is D\+A\+G-\/root, then the prefix of the device is set in the following way\+: 
\begin{DoxyCodeInclude}
\end{DoxyCodeInclude}
 

 \hypertarget{_l_k_n_contribution_Radio_edits}{}\section{Changes in the Radio driver}\label{_l_k_n_contribution_Radio_edits}
The radio was hardcoded set to 0. In our code we set the P\+A\+\_\+\+L\+E\+V\+EL in \hyperlink{group__radio_gaf181029cf06b94f0f4ceaafec1c3f209}{radio\+\_\+reset} to 31. 
\begin{DoxyCodeInclude}
   cc2420\_TXCTRL\_reg.PA\_LEVEL               = 31; \textcolor{comment}{//31 max. TX power (~0dBm)}
\end{DoxyCodeInclude}
 

 \hypertarget{_l_k_n_contribution_DAG_root}{}\section{D\+A\+G root setup}\label{_l_k_n_contribution_DAG_root}
We modified the define in \hyperlink{opendefs_8h}{opendefs.\+h} in order to enable the D\+AG root state from the firmware. 
\begin{DoxyCodeInclude}
\textcolor{preprocessor}{#define DAGROOT 1}
\end{DoxyCodeInclude}
 

 \hypertarget{_l_k_n_contribution_TSCH_scheduling}{}\section{T\+S\+C\+H scheduling}\label{_l_k_n_contribution_TSCH_scheduling}
We enabled a D\+AG root based scheduling by modifying the files \hyperlink{schedule_8c}{schedule.\+c} and \hyperlink{schedule_8h}{schedule.\+h} .

The setup applied in \hyperlink{schedule_8h}{schedule.\+h} by modifying the following frame parameters\+: 
\begin{DoxyCodeInclude}
\textcolor{preprocessor}{#define SLOTFRAME\_LENGTH    15}
\textcolor{preprocessor}{#define NUMSERIALRX          1 }
\textcolor{preprocessor}{#define NUMSLOTSOFF          1 }
\textcolor{preprocessor}{}
\textcolor{preprocessor}{#define SHARED FALSE}

\textcolor{comment}{//draft-ietf-6tisch-minimal-06 }
\textcolor{comment}{}\textcolor{preprocessor}{#define SCHEDULE\_MINIMAL\_6TISCH\_ACTIVE\_CELLS  SLOTFRAME\_LENGTH-NUMSERIALRX-NUMSLOTSOFF//default 1}
\textcolor{preprocessor}{#define SCHEDULE\_MINIMAL\_6TISCH\_SLOTOFFSET                        1//deafult time slot 0}
\textcolor{preprocessor}{#define SCHEDULE\_MINIMAL\_6TISCH\_CHANNELOFFSET                     0//default freq channel 0}
\textcolor{preprocessor}{#define SCHEDULE\_MINIMAL\_6TISCH\_DEFAULT\_SLOTFRAME\_HANDLE          1 //id of slotframe}
\textcolor{preprocessor}{#define SCHEDULE\_MINIMAL\_6TISCH\_DEFAULT\_SLOTFRAME\_NUMBER          1 //1 slotframe by default.}

\end{DoxyCodeInclude}
 The scheduling of the network is computed by the D\+AG root. In the function \hyperlink{group___schedule_gade694f312044f8bff151d58c7976d067}{schedule\+\_\+start\+D\+A\+Groot} the scheduling is applied iteratively in this way\+:


\begin{DoxyCodeInclude}
    addr\_cnt=1;
    \textcolor{keywordflow}{for} (running\_slotOffset=start\_slotOffset;running\_slotOffset<start\_slotOffset+
      \hyperlink{group___schedule_ga299d7e29eb70888b68ace83fd3f1a8df}{SCHEDULE\_MINIMAL\_6TISCH\_ACTIVE\_CELLS};running\_slotOffset++) \{
        temp\_neighbor.addr\_64b[7]   = addr\_cnt;
        addr\_cnt++;
      \hyperlink{group___schedule_ga00825b0f7040c67065d65aadde478241}{schedule\_addActiveSlot}(
         running\_slotOffset,                 \textcolor{comment}{// slot offset}
         \hyperlink{group___schedule_ggad8490d4fdf8cef27f7e5fa6a37046a3da703f29e4d2b16980f09eceaeb7a35281}{CELLTYPE\_TXRX},                      \textcolor{comment}{// type of slot}
         \hyperlink{group___schedule_ga884c794595c4aa480df9022648c29564}{SHARED},                               \textcolor{comment}{// shared?}
         \hyperlink{group___schedule_ga485a603a3e03059901c4fc5fc968a1e9}{SCHEDULE\_MINIMAL\_6TISCH\_CHANNELOFFSET},    \textcolor{comment}{// channel offset
       (default SCHEDULE\_MINIMAL\_6TISCH\_CHANNELOFFSET) TODO try different offsets}
         &temp\_neighbor                      \textcolor{comment}{// neighbor}
      );
      \hyperlink{group___schedule_gafbaaa0f57ce9c382c0fc00225a7b2078}{debugPrint\_schedule}();
   \}
\end{DoxyCodeInclude}
